clear; % clear CommandWindow and workspace
 sayac=0;
 AGS=zeros(3,1);
 eps=1e-8;% for sedumi
 bigeps=eps;% for sedumi
 maxiter=400;% for sedumi
 degrees=1:20;
 timescale=1;
 tolerance=0;
 


 n=2;%the dimension of the state space
 hold on
         G = @(y)(0.1E1+y(1).^2).^3.*(0.1E1+y(2).^2).^3;
  F1=@(y)(-0.260548E-1).*((-0.1361E0)+(-0.144032E0).*y(1)+(-0.993574E0).*y( ...
  1).^2+0.665052E0.*y(1).^3+(-0.14825E1).*y(1).^4+0.13811E1.*y(1) ...
  .^5+(-0.625023E0).*y(1).^6+0.572016E0.*y(1).^7+0.427984E0.*y(2)+ ...
  0.898344E0.*y(1).*y(2)+0.147252E1.*y(1).^2.*y(2)+(-0.314601E-1).* ...
  y(1).^3.*y(2)+(-0.625512E0).*y(1).^4.*y(2)+(-0.217985E1).*y(1) ...
  .^5.*y(2)+(-0.167005E1).*y(1).^6.*y(2)+(-0.125005E1).*y(1).^7.*y( ...
  2)+(-0.232451E0).*y(2).^2+(-0.192685E0).*y(1).*y(2).^2+ ...
  0.271076E1.*y(1).^2.*y(2).^2+0.766375E1.*y(1).^3.*y(2).^2+ ...
  0.467362E1.*y(1).^4.*y(2).^2+0.790243E1.*y(1).^5.*y(2).^2+ ...
  0.173041E1.*y(1).^6.*y(2).^2+0.459979E-1.*y(1).^7.*y(2).^2+ ...
  0.161817E1.*y(2).^3+(-0.929805E0).*y(1).*y(2).^3+0.10435E1.*y(1) ...
  .^2.*y(2).^3+(-0.862401E0).*y(1).^3.*y(2).^3+0.485451E1.*y(1).^4.* ...
  y(2).^3+(-0.862401E0).*y(1).^5.*y(2).^3+0.542918E1.*y(1).^6.*y(2) ...
  .^3+(-0.929805E0).*y(1).^7.*y(2).^3+0.232451E0.*y(2).^4+ ...
  0.25219E1.*y(1).*y(2).^4+0.266021E1.*y(1).^2.*y(2).^4+0.437449E1.* ...
  y(1).^3.*y(2).^4+0.606833E1.*y(1).^4.*y(2).^4+0.461317E1.*y(1) ...
  .^5.*y(2).^4+0.364057E1.*y(1).^6.*y(2).^4+0.276059E1.*y(1).^7.*y( ...
  2).^4+0.427984E0.*y(2).^5+(-0.125005E1).*y(1).*y(2).^5+ ...
  0.338199E1.*y(1).^2.*y(2).^5+(-0.217985E1).*y(1).^3.*y(2).^5+ ...
  0.319341E1.*y(1).^4.*y(2).^5+(-0.314601E-1).*y(1).^5.*y(2).^5+ ...
  0.239412E0.*y(1).^6.*y(2).^5+0.898344E0.*y(1).^7.*y(2).^5+ ...
  0.1361E0.*y(2).^6+0.283951E0.*y(1).*y(2).^6+(-0.806206E-1).*y(1) ...
  .^2.*y(2).^6+0.271121E1.*y(1).^3.*y(2).^6+(-0.665893E0).*y(1).^4.* ...
  y(2).^6+0.342725E1.*y(1).^5.*y(2).^6+(-0.449172E0).*y(1).^6.*y(2) ...
  .^6+0.1E1.*y(1).^7.*y(2).^6);

  F2=@(y)(-0.260548E-1).*((-0.1361E0)+0.427984E0.*y(1)+(-0.232451E0).*y(1) ...
  .^2+0.161817E1.*y(1).^3+0.232451E0.*y(1).^4+0.427984E0.*y(1).^5+ ...
  0.1361E0.*y(1).^6+(-0.144032E0).*y(2)+0.898344E0.*y(1).*y(2)+( ...
  -0.192685E0).*y(1).^2.*y(2)+(-0.929805E0).*y(1).^3.*y(2)+ ...
  0.25219E1.*y(1).^4.*y(2)+(-0.125005E1).*y(1).^5.*y(2)+0.283951E0.* ...
  y(1).^6.*y(2)+(-0.993574E0).*y(2).^2+0.147252E1.*y(1).*y(2).^2+ ...
  0.271076E1.*y(1).^2.*y(2).^2+0.10435E1.*y(1).^3.*y(2).^2+ ...
  0.266021E1.*y(1).^4.*y(2).^2+0.338199E1.*y(1).^5.*y(2).^2+( ...
  -0.806206E-1).*y(1).^6.*y(2).^2+0.665052E0.*y(2).^3+(-0.314601E-1) ...
  .*y(1).*y(2).^3+0.766375E1.*y(1).^2.*y(2).^3+(-0.862401E0).*y(1) ...
  .^3.*y(2).^3+0.437449E1.*y(1).^4.*y(2).^3+(-0.217985E1).*y(1).^5.* ...
  y(2).^3+0.271121E1.*y(1).^6.*y(2).^3+(-0.14825E1).*y(2).^4+( ...
  -0.625512E0).*y(1).*y(2).^4+0.467362E1.*y(1).^2.*y(2).^4+ ...
  0.485451E1.*y(1).^3.*y(2).^4+0.606833E1.*y(1).^4.*y(2).^4+ ...
  0.319341E1.*y(1).^5.*y(2).^4+(-0.665893E0).*y(1).^6.*y(2).^4+ ...
  0.13811E1.*y(2).^5+(-0.217985E1).*y(1).*y(2).^5+0.790243E1.*y(1) ...
  .^2.*y(2).^5+(-0.862401E0).*y(1).^3.*y(2).^5+0.461317E1.*y(1).^4.* ...
  y(2).^5+(-0.314601E-1).*y(1).^5.*y(2).^5+0.342725E1.*y(1).^6.*y(2) ...
  .^5+(-0.625023E0).*y(2).^6+(-0.167005E1).*y(1).*y(2).^6+ ...
  0.173041E1.*y(1).^2.*y(2).^6+0.542918E1.*y(1).^3.*y(2).^6+ ...
  0.364057E1.*y(1).^4.*y(2).^6+0.239412E0.*y(1).^5.*y(2).^6+( ...
  -0.449172E0).*y(1).^6.*y(2).^6+0.572016E0.*y(2).^7+(-0.125005E1).* ...
  y(1).*y(2).^7+0.459979E-1.*y(1).^2.*y(2).^7+(-0.929805E0).*y(1) ...
  .^3.*y(2).^7+0.276059E1.*y(1).^4.*y(2).^7+0.898344E0.*y(1).^5.*y( ...
  2).^7+0.1E1.*y(1).^6.*y(2).^7+0.332899E-16.*y(2).^8+0.665798E-16.* ...
  y(1).*y(2).^8+(-0.665798E-16).*y(1).^2.*y(2).^8+0.13316E-15.*y(1) ...
  .^3.*y(2).^8+(-0.665798E-16).*y(1).^4.*y(2).^8+0.665798E-16.*y(1) ...
  .^5.*y(2).^8);

        for degree=degrees%this is actually the half of the degree
            degreeInt=1;
            x=sdpvar(n,1);
            y=sdpvar(n-1,1);
            degree*2;
            [rho,wrho] = polynomial(x,2*degree);
           
            f1 = F1(x);
            f2 = F2(x);
            g = G(x);
            div = jacobian( f1, x(1) )+...
                jacobian( f2, x(2) );
            fun = (g*rho*div+jacobian(rho,x)*[f1;f2]*g-rho*jacobian(g,x)*[f1;f2]);
            
            constr = [sos(fun),sos(rho-tolerance)];
           
            params = [wrho];
%             constr =
%             [sos(fun),sos(rho),sum(wrho)>=tolerance,wrho(1)>=tolerance];
%             params = [wrho];
%             constr = [sos(funRed),sos(rhoRed),sum(wrhoRed)>=toleranceRed];
%            params = [ wrhoRed];
            %options = sdpsettings('solver','sdpa');
            %options = sdpsettings('solver','sdpt3');
            options = sdpsettings('solver','sedumi','verbose',0,'sedumi.eps',eps,'sedumi.bigeps', ...
                bigeps,'sedumi.maxiter',maxiter);
            %options = sdpsettings('solver','mosek');
            [sol,~,~,~]=solvesos(constr,1,options,params);
            if sol.problem==0
                
                               
              
                break
            end
          
        end
 
display(double(wrho));


realparamB=double(wrho)
        x = sdpvar(1,1);y = sdpvar(1,1);
        vv = monolist([x; y],degree*2);
      
        Bpoly = sdisplay(round(realparamB,2)'*vv)
         B=eval(['@(x,y)' Bpoly{1}])
           
