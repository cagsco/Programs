clear; % clear CommandWindow and workspace
 sayac=0;
 AGS=zeros(3,1);
 eps=1e-8;% for sedumi
 bigeps=eps;% for sedumi
 maxiter=400;% for sedumi
 degrees=1:20;
 timescale=1;
 tolerance=0;
 


 n=2;%the dimension of the state space
 hold on
         G = @(y)(0.1E1+y(1).^2).^5.*(0.1E1+y(2).^2).^5;
  F1=@(y)(-0.103623E-1).*((-0.311597E0)+(-0.130364E1).*y(1)+(-0.448283E1).* ...
  y(1).^2+0.800061E1.*y(1).^3+(-0.779684E1).*y(1).^4+0.137204E1.*y( ...
  1).^5+(-0.87296E1).*y(1).^6+0.111542E1.*y(1).^7+(-0.745259E1).*y( ...
  1).^8+0.101995E2.*y(1).^9+(-0.23486E1).*y(1).^10+0.115182E1.*y(1) ...
  .^11+(-0.151822E0).*y(2)+0.52265E1.*y(1).*y(2)+0.218219E2.*y(1) ...
  .^2.*y(2)+(-0.136409E2).*y(1).^3.*y(2)+(-0.864711E2).*y(1).^4.*y( ...
  2)+(-0.999712E1).*y(1).^5.*y(2)+(-0.910432E1).*y(1).^6.*y(2)+ ...
  0.724312E1.*y(1).^7.*y(2)+0.648922E2.*y(1).^8.*y(2)+(-0.632437E1) ...
  .*y(1).^9.*y(2)+(-0.344483E2).*y(1).^10.*y(2)+(-0.46972E1).*y(1) ...
  .^11.*y(2)+(-0.182263E1).*y(2).^2+(-0.292511E2).*y(1).*y(2).^2+ ...
  0.408846E2.*y(1).^2.*y(2).^2+0.322055E3.*y(1).^3.*y(2).^2+( ...
  -0.401465E2).*y(1).^4.*y(2).^2+(-0.311711E3).*y(1).^5.*y(2).^2+( ...
  -0.570169E2).*y(1).^6.*y(2).^2+(-0.281305E3).*y(1).^7.*y(2).^2+ ...
  0.445335E2.*y(1).^8.*y(2).^2+0.353023E3.*y(1).^9.*y(2).^2+ ...
  0.186966E2.*y(1).^10.*y(2).^2+(-0.286892E2).*y(1).^11.*y(2).^2+ ...
  0.183519E2.*y(2).^3+(-0.188674E2).*y(1).*y(2).^3+(-0.194673E3).*y( ...
  1).^2.*y(2).^3+0.148888E3.*y(1).^3.*y(2).^3+0.114582E4.*y(1).^4.* ...
  y(2).^3+(-0.230151E2).*y(1).^5.*y(2).^3+0.113226E3.*y(1).^6.*y(2) ...
  .^3+(-0.21106E3).*y(1).^7.*y(2).^3+(-0.909143E3).*y(1).^8.*y(2) ...
  .^3+(-0.219172E2).*y(1).^9.*y(2).^3+0.336474E3.*y(1).^10.*y(2).^3+ ...
  (-0.162717E1).*y(1).^11.*y(2).^3+0.147838E1.*y(2).^4+0.938902E2.* ...
  y(1).*y(2).^4+(-0.793414E2).*y(1).^2.*y(2).^4+(-0.988391E3).*y(1) ...
  .^3.*y(2).^4+0.289575E3.*y(1).^4.*y(2).^4+0.149837E4.*y(1).^5.*y( ...
  2).^4+0.223182E3.*y(1).^6.*y(2).^4+0.142551E4.*y(1).^7.*y(2).^4+( ...
  -0.119343E3).*y(1).^8.*y(2).^4+(-0.104428E4).*y(1).^9.*y(2).^4+ ...
  0.278709E2.*y(1).^10.*y(2).^4+0.110859E3.*y(1).^11.*y(2).^4+( ...
  -0.158644E2).*y(2).^5+0.88703E1.*y(1).*y(2).^5+0.52817E3.*y(1) ...
  .^2.*y(2).^5+(-0.1819E3).*y(1).^3.*y(2).^5+(-0.227459E4).*y(1) ...
  .^4.*y(2).^5+0.163282E3.*y(1).^5.*y(2).^5+(-0.158644E3).*y(1).^6.* ...
  y(2).^5+0.163282E3.*y(1).^7.*y(2).^5+0.203662E4.*y(1).^8.*y(2).^5+ ...
  (-0.1819E3).*y(1).^9.*y(2).^5+(-0.623356E3).*y(1).^10.*y(2).^5+ ...
  0.88703E1.*y(1).^11.*y(2).^5+(-0.147838E1).*y(2).^6+(-0.113895E3) ...
  .*y(1).*y(2).^6+0.190006E2.*y(1).^2.*y(2).^6+0.140828E4.*y(1).^3.* ...
  y(2).^6+(-0.141519E3).*y(1).^4.*y(2).^6+(-0.137577E4).*y(1).^5.*y( ...
  2).^6+0.193614E3.*y(1).^6.*y(2).^6+(-0.144862E4).*y(1).^7.*y(2) ...
  .^6+0.2674E3.*y(1).^8.*y(2).^6+0.135239E4.*y(1).^9.*y(2).^6+( ...
  -0.882117E2).*y(1).^10.*y(2).^6+(-0.969266E2).*y(1).^11.*y(2).^6+ ...
  0.183519E2.*y(2).^7+(-0.162717E1).*y(1).*y(2).^7+(-0.226363E3).*y( ...
  1).^2.*y(2).^7+(-0.219172E2).*y(1).^3.*y(2).^7+0.118442E4.*y(1) ...
  .^4.*y(2).^7+(-0.21106E3).*y(1).^5.*y(2).^7+0.253812E3.*y(1).^6.* ...
  y(2).^7+(-0.230151E2).*y(1).^7.*y(2).^7+(-0.870539E3).*y(1).^8.*y( ...
  2).^7+0.148888E3.*y(1).^9.*y(2).^7+0.304785E3.*y(1).^10.*y(2).^7+( ...
  -0.188674E2).*y(1).^11.*y(2).^7+0.182263E1.*y(2).^8+0.27171E2.*y( ...
  1).*y(2).^8+0.296324E2.*y(1).^2.*y(2).^8+(-0.171023E3).*y(1).^3.* ...
  y(2).^8+0.71873E2.*y(1).^4.*y(2).^8+0.306179E3.*y(1).^5.*y(2).^8+( ...
  -0.205642E2).*y(1).^6.*y(2).^8+0.336586E3.*y(1).^7.*y(2).^8+( ...
  -0.128071E2).*y(1).^8.*y(2).^8+(-0.140054E3).*y(1).^9.*y(2).^8+ ...
  0.518204E2.*y(1).^10.*y(2).^8+0.277329E2.*y(1).^11.*y(2).^8+( ...
  -0.151822E0).*y(2).^9+(-0.46972E1).*y(1).*y(2).^9+0.335374E2.*y(1) ...
  .^2.*y(2).^9+(-0.632437E1).*y(1).^3.*y(2).^9+(-0.671695E2).*y(1) ...
  .^4.*y(2).^9+0.724312E1.*y(1).^5.*y(2).^9+0.606789E1.*y(1).^6.*y( ...
  2).^9+(-0.999712E1).*y(1).^7.*y(2).^9+0.841938E2.*y(1).^8.*y(2) ...
  .^9+(-0.136409E2).*y(1).^9.*y(2).^9+(-0.227329E2).*y(1).^10.*y(2) ...
  .^9+0.52265E1.*y(1).^11.*y(2).^9+0.311597E0.*y(2).^10+( ...
  -0.145547E1).*y(1).*y(2).^10+(-0.479021E0).*y(1).^2.*y(2).^10+ ...
  0.262007E2.*y(1).^3.*y(2).^10+(-0.277864E1).*y(1).^4.*y(2).^10+ ...
  0.38595E1.*y(1).^5.*y(2).^10+(-0.249767E1).*y(1).^6.*y(2).^10+ ...
  0.360288E1.*y(1).^7.*y(2).^10+(-0.31229E1).*y(1).^8.*y(2).^10+ ...
  0.283995E2.*y(1).^9.*y(2).^10+(-0.261325E1).*y(1).^10.*y(2).^10+ ...
  0.1E1.*y(1).^11.*y(2).^10);

  F2=@(y)0.322886E-2+0.157323E-2.*y(1)+0.188867E-1.*y(1).^2+(-0.190168E0).* ...
  y(1).^3+(-0.153195E-1).*y(1).^4+0.164392E0.*y(1).^5+0.153195E-1.* ...
  y(1).^6+(-0.190168E0).*y(1).^7+(-0.188867E-1).*y(1).^8+ ...
  0.157323E-2.*y(1).^9+(-0.322886E-2).*y(1).^10+0.135088E-1.*y(2)+( ...
  -0.541586E-1).*y(1).*y(2)+0.303109E0.*y(1).^2.*y(2)+0.19551E0.*y( ...
  1).^3.*y(2)+(-0.97292E0).*y(1).^4.*y(2)+(-0.919168E-1).*y(1).^5.* ...
  y(2)+0.118022E1.*y(1).^6.*y(2)+0.168613E-1.*y(1).^7.*y(2)+( ...
  -0.281554E0).*y(1).^8.*y(2)+0.486739E-1.*y(1).^9.*y(2)+ ...
  0.15082E-1.*y(1).^10.*y(2)+0.464525E-1.*y(2).^2+(-0.226126E0).*y( ...
  1).*y(2).^2+(-0.423659E0).*y(1).^2.*y(2).^2+0.201727E1.*y(1).^3.* ...
  y(2).^2+0.822161E0.*y(1).^4.*y(2).^2+(-0.547306E1).*y(1).^5.*y(2) ...
  .^2+(-0.19689E0).*y(1).^6.*y(2).^2+0.234564E1.*y(1).^7.*y(2).^2+( ...
  -0.307061E0).*y(1).^8.*y(2).^2+(-0.347525E0).*y(1).^9.*y(2).^2+ ...
  0.496376E-2.*y(1).^10.*y(2).^2+(-0.829049E-1).*y(2).^3+ ...
  0.141352E0.*y(1).*y(2).^3+(-0.333723E1).*y(1).^2.*y(2).^3+( ...
  -0.154282E1).*y(1).^3.*y(2).^3+0.10242E2.*y(1).^4.*y(2).^3+ ...
  0.188491E1.*y(1).^5.*y(2).^3+(-0.145931E2).*y(1).^6.*y(2).^3+ ...
  0.227113E0.*y(1).^7.*y(2).^3+0.177219E1.*y(1).^8.*y(2).^3+ ...
  0.655352E-1.*y(1).^9.*y(2).^3+(-0.2715E0).*y(1).^10.*y(2).^3+ ...
  0.807934E-1.*y(2).^4+0.896041E0.*y(1).*y(2).^4+0.416011E0.*y(1) ...
  .^2.*y(2).^4+(-0.118733E2).*y(1).^3.*y(2).^4+(-0.300067E1).*y(1) ...
  .^4.*y(2).^4+0.2357E2.*y(1).^5.*y(2).^4+0.146646E1.*y(1).^6.*y(2) ...
  .^4+(-0.122733E2).*y(1).^7.*y(2).^4+(-0.744771E0).*y(1).^8.*y(2) ...
  .^4+0.696032E0.*y(1).^9.*y(2).^4+0.287932E-1.*y(1).^10.*y(2).^4+( ...
  -0.142175E-1).*y(2).^5+0.103593E0.*y(1).*y(2).^5+0.323005E1.*y(1) ...
  .^2.*y(2).^5+0.238489E0.*y(1).^3.*y(2).^5+(-0.155266E2).*y(1).^4.* ...
  y(2).^5+(-0.169198E1).*y(1).^5.*y(2).^5+0.142561E2.*y(1).^6.*y(2) ...
  .^5+0.218707E1.*y(1).^7.*y(2).^5+(-0.317273E1).*y(1).^8.*y(2).^5+( ...
  -0.750555E-1).*y(1).^9.*y(2).^5+(-0.399934E-1).*y(1).^10.*y(2).^5+ ...
  0.904589E-1.*y(2).^6+0.943419E-1.*y(1).*y(2).^6+0.590827E0.*y(1) ...
  .^2.*y(2).^6+(-0.117329E1).*y(1).^3.*y(2).^6+(-0.231268E1).*y(1) ...
  .^4.*y(2).^6+0.164392E1.*y(1).^5.*y(2).^6+(-0.200629E1).*y(1).^6.* ...
  y(2).^6+(-0.263008E1).*y(1).^7.*y(2).^6+0.213093E0.*y(1).^8.*y(2) ...
  .^6+(-0.628773E-1).*y(1).^9.*y(2).^6+0.258817E-1.*y(1).^10.*y(2) ...
  .^6+(-0.115583E-1).*y(2).^7+(-0.750555E-1).*y(1).*y(2).^7+ ...
  0.291497E1.*y(1).^2.*y(2).^7+0.218707E1.*y(1).^3.*y(2).^7+( ...
  -0.147716E2).*y(1).^4.*y(2).^7+(-0.169198E1).*y(1).^5.*y(2).^7+ ...
  0.150111E2.*y(1).^6.*y(2).^7+0.238489E0.*y(1).^7.*y(2).^7+( ...
  -0.348781E1).*y(1).^8.*y(2).^7+0.103593E0.*y(1).^9.*y(2).^7+( ...
  -0.373342E-1).*y(1).^10.*y(2).^7+0.772261E-1.*y(2).^8+( ...
  -0.672434E0).*y(1).*y(2).^8+(-0.46147E0).*y(1).^2.*y(2).^8+ ...
  0.942082E1.*y(1).^3.*y(2).^8+0.123667E1.*y(1).^4.*y(2).^8+( ...
  -0.211041E2).*y(1).^5.*y(2).^8+(-0.277088E1).*y(1).^6.*y(2).^8+ ...
  0.90208E1.*y(1).^7.*y(2).^8+0.132711E0.*y(1).^8.*y(2).^8+( ...
  -0.872443E0).*y(1).^9.*y(2).^8+0.323604E-1.*y(1).^10.*y(2).^8+( ...
  -0.10569E0).*y(2).^9+0.655352E-1.*y(1).*y(2).^9+(-0.365814E1).*y( ...
  1).^2.*y(2).^9+0.227113E0.*y(1).^3.*y(2).^9+0.108212E2.*y(1).^4.* ...
  y(2).^9+0.188491E1.*y(1).^5.*y(2).^9+(-0.140139E2).*y(1).^6.*y(2) ...
  .^9+(-0.154282E1).*y(1).^7.*y(2).^9+0.145129E1.*y(1).^8.*y(2).^9+ ...
  0.141352E0.*y(1).^9.*y(2).^9+(-0.294285E0).*y(1).^10.*y(2).^9+ ...
  0.243369E-1.*y(2).^10+0.356964E0.*y(1).*y(2).^10+(-0.19374E0).*y( ...
  1).^2.*y(2).^10+(-0.348665E1).*y(1).^3.*y(2).^10+(-0.288807E0).*y( ...
  1).^4.*y(2).^10+0.645941E1.*y(1).^5.*y(2).^10+0.914077E0.*y(1) ...
  .^6.*y(2).^10+(-0.315828E1).*y(1).^7.*y(2).^10+(-0.536979E0).*y(1) ...
  .^8.*y(2).^10+0.235565E0.*y(1).^9.*y(2).^10+0.270793E-1.*y(1) ...
  .^10.*y(2).^10+(-0.119355E-1).*y(2).^11+0.486739E-1.*y(1).*y(2) ...
  .^11+0.297287E0.*y(1).^2.*y(2).^11+0.168613E-1.*y(1).^3.*y(2).^11+ ...
  (-0.114875E1).*y(1).^4.*y(2).^11+(-0.919168E-1).*y(1).^5.*y(2) ...
  .^11+0.100438E1.*y(1).^6.*y(2).^11+0.19551E0.*y(1).^7.*y(2).^11+( ...
  -0.287377E0).*y(1).^8.*y(2).^11+(-0.541586E-1).*y(1).^9.*y(2).^11+ ...
  (-0.103623E-1).*y(1).^10.*y(2).^11+(-0.21684E-18).*y(2).^12+ ...
  0.416334E-16.*y(1).^3.*y(2).^12+0.346945E-17.*y(1).^4.*y(2).^12+ ...
  0.555112E-16.*y(1).^5.*y(2).^12+0.346945E-17.*y(1).^6.*y(2).^12+ ...
  0.416334E-16.*y(1).^7.*y(2).^12+0.650521E-18.*y(1).^10.*y(2).^12;

        for degree=degrees%this is actually the half of the degree
            degreeInt=1;
            x=sdpvar(n,1);
            y=sdpvar(n-1,1);
            degree*2;
            [rho,wrho] = polynomial(x,2*degree);
           
            f1 = F1(x);
            f2 = F2(x);
            g = G(x);
            div = jacobian( f1, x(1) )+...
                jacobian( f2, x(2) );
            fun = (g*rho*div+jacobian(rho,x)*[f1;f2]*g-rho*jacobian(g,x)*[f1;f2]);
            
            constr = [sos(fun),sos(rho-tolerance)];
           
            params = [wrho];
%             constr =
%             [sos(fun),sos(rho),sum(wrho)>=tolerance,wrho(1)>=tolerance];
%             params = [wrho];
%             constr = [sos(funRed),sos(rhoRed),sum(wrhoRed)>=toleranceRed];
%            params = [ wrhoRed];
            %options = sdpsettings('solver','sdpa');
            %options = sdpsettings('solver','sdpt3');
            options = sdpsettings('solver','sedumi','verbose',0,'sedumi.eps',eps,'sedumi.bigeps', ...
                bigeps,'sedumi.maxiter',maxiter);
            %options = sdpsettings('solver','mosek');
            [sol,~,~,~]=solvesos(constr,1,options,params);
            if sol.problem==0
                
                               
              
                break
            end
          
        end
 
display(double(wrho));


realparamB=double(wrho)
        x = sdpvar(1,1);y = sdpvar(1,1);
        vv = monolist([x; y],degree*2);
      
        Bpoly = sdisplay(round(realparamB,10)'*vv)
         B=eval(['@(x,y)' Bpoly{1}])
           








