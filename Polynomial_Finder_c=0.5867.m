clear; % clear CommandWindow and workspace
 sayac=0;
 AGS=zeros(3,1);
 eps=1e-8;% for sedumi
 bigeps=eps;% for sedumi
 maxiter=400;% for sedumi
 degrees=1:20;
 timescale=1;
 tolerance=0;
 


 n=2;%the dimension of the state space
 hold on
         G = @(y)(0.1E1+y(1).^2).^3.*(0.1E1+y(2).^2).^3;
  F1=@(y)0.346744E-1.*((-0.117261E0)+0.12194E-1.*y(1)+(-0.774436E0).*y(1) ...
  .^2+0.575833E0.*y(1).^3+(-0.122573E1).*y(1).^4+0.105754E1.*y(1) ...
  .^5+(-0.56855E0).*y(1).^6+0.493903E0.*y(1).^7+0.506097E0.*y(2)+ ...
  0.610784E0.*y(1).*y(2)+0.104864E1.*y(1).^2.*y(2)+0.256284E0.*y(1) ...
  .^3.*y(2)+0.233734E0.*y(1).^4.*y(2)+(-0.14916E1).*y(1).^5.*y(2)+( ...
  -0.308808E0).*y(1).^6.*y(2)+(-0.11371E1).*y(1).^7.*y(2)+( ...
  -0.88625E-1).*y(2).^2+0.101233E1.*y(1).*y(2).^2+0.170421E1.*y(1) ...
  .^2.*y(2).^2+0.440595E1.*y(1).^3.*y(2).^2+0.410384E1.*y(1).^4.*y( ...
  2).^2+0.456652E1.*y(1).^5.*y(2).^2+0.2311E1.*y(1).^6.*y(2).^2+ ...
  0.11729E1.*y(1).^7.*y(2).^2+0.112728E1.*y(2).^3+(-0.3545E0).*y(1) ...
  .*y(2).^3+0.280641E1.*y(1).^2.*y(2).^3+(-0.163622E1).*y(1).^3.*y( ...
  2).^3+0.338183E1.*y(1).^4.*y(2).^3+(-0.163622E1).*y(1).^5.*y(2) ...
  .^3+0.17027E1.*y(1).^6.*y(2).^3+(-0.3545E0).*y(1).^7.*y(2).^3+ ...
  0.88625E-1.*y(2).^4+0.186368E1.*y(1).*y(2).^4+0.26655E1.*y(1).^2.* ...
  y(2).^4+0.523373E1.*y(1).^3.*y(2).^4+0.463559E1.*y(1).^4.*y(2).^4+ ...
  0.53943E1.*y(1).^5.*y(2).^4+0.205871E1.*y(1).^6.*y(2).^4+ ...
  0.202425E1.*y(1).^7.*y(2).^4+0.506097E0.*y(2).^5+(-0.11371E1).*y( ...
  1).*y(2).^5+0.23332E1.*y(1).^2.*y(2).^5+(-0.14916E1).*y(1).^3.*y( ...
  2).^5+0.280285E1.*y(1).^4.*y(2).^5+0.256284E0.*y(1).^5.*y(2).^5+ ...
  0.975749E0.*y(1).^6.*y(2).^5+0.610784E0.*y(1).^7.*y(2).^5+ ...
  0.117261E0.*y(2).^6+0.518291E0.*y(1).*y(2).^6+(-0.995058E-1).*y(1) ...
  .^2.*y(2).^6+0.220921E1.*y(1).^3.*y(2).^6+(-0.522159E0).*y(1).^4.* ...
  y(2).^6+0.269092E1.*y(1).^5.*y(2).^6+(-0.305392E0).*y(1).^6.*y(2) ...
  .^6+0.1E1.*y(1).^7.*y(2).^6);

  F2=@(y)(-0.406596E-2)+0.175486E-1.*y(1)+(-0.307302E-2).*y(1).^2+ ...
  0.390877E-1.*y(1).^3+0.307302E-2.*y(1).^4+0.175486E-1.*y(1).^5+ ...
  0.406596E-2.*y(1).^6+0.422821E-3.*y(2)+0.211786E-1.*y(1).*y(2)+ ...
  0.35102E-1.*y(1).^2.*y(2)+(-0.122921E-1).*y(1).^3.*y(2)+ ...
  0.64622E-1.*y(1).^4.*y(2)+(-0.394283E-1).*y(1).^5.*y(2)+ ...
  0.179714E-1.*y(1).^6.*y(2)+(-0.268531E-1).*y(2).^2+0.363609E-1.*y( ...
  1).*y(2).^2+0.590925E-1.*y(1).^2.*y(2).^2+0.973107E-1.*y(1).^3.*y( ...
  2).^2+0.924247E-1.*y(1).^4.*y(2).^2+0.809022E-1.*y(1).^5.*y(2).^2+ ...
  (-0.34503E-2).*y(1).^6.*y(2).^2+0.199667E-1.*y(2).^3+0.888649E-2.* ...
  y(1).*y(2).^3+0.152774E0.*y(1).^2.*y(2).^3+(-0.567351E-1).*y(1) ...
  .^3.*y(2).^3+0.181477E0.*y(1).^4.*y(2).^3+(-0.517204E-1).*y(1) ...
  .^5.*y(2).^3+0.76603E-1.*y(1).^6.*y(2).^3+(-0.425013E-1).*y(2).^4+ ...
  0.810458E-2.*y(1).*y(2).^4+0.142298E0.*y(1).^2.*y(2).^4+ ...
  0.117263E0.*y(1).^3.*y(2).^4+0.160736E0.*y(1).^4.*y(2).^4+ ...
  0.971871E-1.*y(1).^5.*y(2).^4+(-0.181055E-1).*y(1).^6.*y(2).^4+ ...
  0.366696E-1.*y(2).^5+(-0.517204E-1).*y(1).*y(2).^5+0.158341E0.*y( ...
  1).^2.*y(2).^5+(-0.567351E-1).*y(1).^3.*y(2).^5+0.187044E0.*y(1) ...
  .^4.*y(2).^5+0.888649E-2.*y(1).^5.*y(2).^5+0.93306E-1.*y(1).^6.*y( ...
  2).^5+(-0.197141E-1).*y(2).^6+(-0.107077E-1).*y(1).*y(2).^6+ ...
  0.801326E-1.*y(1).^2.*y(2).^6+0.590401E-1.*y(1).^3.*y(2).^6+ ...
  0.713845E-1.*y(1).^4.*y(2).^6+0.338335E-1.*y(1).^5.*y(2).^6+( ...
  -0.105893E-1).*y(1).^6.*y(2).^6+0.171258E-1.*y(2).^7+( ...
  -0.394283E-1).*y(1).*y(2).^7+0.406697E-1.*y(1).^2.*y(2).^7+( ...
  -0.122921E-1).*y(1).^3.*y(2).^7+0.701897E-1.*y(1).^4.*y(2).^7+ ...
  0.211786E-1.*y(1).^5.*y(2).^7+0.346744E-1.*y(1).^6.*y(2).^7+ ...
  0.433681E-18.*y(2).^8+(-0.520417E-17).*y(1).^2.*y(2).^8+ ...
  0.173472E-17.*y(1).^4.*y(2).^8+0.433681E-18.*y(1).^6.*y(2).^8;

        for degree=degrees%this is actually the half of the degree
            degreeInt=1;
            x=sdpvar(n,1);
            y=sdpvar(n-1,1);
            degree*2;
            [rho,wrho] = polynomial(x,2*degree);
           
            f1 = F1(x);
            f2 = F2(x);
            g = G(x);
            div = jacobian( f1, x(1) )+...
                jacobian( f2, x(2) );
            fun = (g*rho*div+jacobian(rho,x)*[f1;f2]*g-rho*jacobian(g,x)*[f1;f2]);
            
            constr = [sos(fun),sos(rho-tolerance)];
           
            params = [wrho];
%             constr =
%             [sos(fun),sos(rho),sum(wrho)>=tolerance,wrho(1)>=tolerance];
%             params = [wrho];
%             constr = [sos(funRed),sos(rhoRed),sum(wrhoRed)>=toleranceRed];
%            params = [ wrhoRed];
            %options = sdpsettings('solver','sdpa');
            %options = sdpsettings('solver','sdpt3');
            options = sdpsettings('solver','sedumi','verbose',0,'sedumi.eps',eps,'sedumi.bigeps', ...
                bigeps,'sedumi.maxiter',maxiter);
            %options = sdpsettings('solver','mosek');
            [sol,~,~,~]=solvesos(constr,1,options,params);
            if sol.problem==0
                
                               
              
                break
            end
          
        end
 
display(double(wrho));


realparamB=double(wrho)
        x = sdpvar(1,1);y = sdpvar(1,1);
        vv = monolist([x; y],degree*2);
      
        Bpoly = sdisplay(round(realparamB,2)'*vv)
         B=eval(['@(x,y)' Bpoly{1}])
           
